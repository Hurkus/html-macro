<SET ci='ci + 1' cii='0'/>
<!--  -->
<INCLUDE HEADER SRC="macros/element-SET.html"/>
<!--  -->
<section id="expressions" class="chapter">
	<h2><a href="#expressions">{ci}. Expressions</a></h2>
	<p>
		In certain contexts, expressions can be used to interpolate HTML text nodes,
		or to provide computed values to <a href="#macros">macros</a>.
		They consist of constants, expression operators, variables and functions.
	</p>
	<br/>
	<p>
		There are only 3 fundamental data types that can be evaluated from expressions:
		<ul>
			<li><b>int</b>eger: <i>long</i>, 64 bit,</li>
			<li><b>float</b>ing point number: <i>double</i>, 64 bit,</li>
			<li><b>string</b>.</li>
		</ul>
	</p>
	<br/>
	<p>
		For purposes of easier explanation and documentation, 2 implicit data types are defined:
		<ul>
			<li><b>number</b>: <b>int</b> or <b>float</b>,</li>
			<li>
				<b>bool</b>ean: <b>int</b> where logical
				<code>false</code> equals <code>0</code> and
				<code>true</code> equals <code>1</code>.
			</li>
		</ul> 
	</p>
	
	
	<br/>
	<br/>
	<section id="expression-context">
		<SET cii='cii + 1'/>
		<h3><a href="#expression-context">{ci}.{cii}. Expression context</a></h3>
		<p>
			Expressions can be defined and evaluated within HTML attribute values or HTML text nodes.
			HTML attribute values, quoted with single quotes (<code>&apos;&apos;</code>),
			are directly evaluated as expressions and then converted to text before they are appended to the final document.
			Attribute values, quoted with double quotes (<code>&quot;&quot;</code>),
			are evaluated as strings, which are interpolated for any expressions contained within curly brackets <code>\{}</code>.
			Similarly, HTML text nodes are also interpolated for expressions within curly brackets.
		</p>
		<br/>
		<div class="example">
			<h4><b>Example:</b> Attribute expressions and text interpolation.</h4>
			<table>
				<tr>
					<th>input</th>
					<th>output</th>
				</tr>
				<tr>
					<td class="code">
						&lt;p attr="text <span title="Replace this expression with its result (3)">\{1 + 2}</span>"&gt;&lt;/p&gt;<br/>
						&lt;p attr=<span title="Set attribute value to the result of this expression (4)">'2 * 2'</span>&gt;&lt;/p&gt;<br/>
						&lt;p&gt;There are <span title="Replace this expression with its result (4.5)">\{9.0 / 2}</span> apples.&lt;/p&gt;
					</td>
					<td class="code">
						&lt;p attr="text 3"&gt;&lt;/p&gt;<br/>
						&lt;p attr="4"&gt;&lt;/p&gt;<br/>
						&lt;p&gt;There are 4.5 apples.&lt;/p&gt;
					</td>
				</tr>
			</table>
		</div>
	</section>
	
	
	<br/>
	<br/>
	<section id="expression-constants">
		<SET cii='cii + 1'/>
		<h3><a href="#expression-constants">{ci}.{cii}. Constants</a></h3>
		<p>
			Regex descriptions for types of constants:
			<ul>
				<li><b>int:</b> <code>-?[0-9]+</code></li>
				<li><b>float:</b> <code>-?[0-9]+[.][0-9]+</code></li>
				<li><b>string:</b> <code>&quot;.*?&quot;|&apos;.*?&apos;</code> (All text between either single <code>&apos;</code> or double <code>&quot;</code> quotes)</li>
			</ul>
		</p>
		
		<br/>
		<style>
			#expression-constants table td {
				min-width: 6em;
			}
		</style>
		<p>
			Some predefined <a href="#expression-variables" title="1.4 Variables">variables</a> are available for certain numeric/logical constants:
		</p>
		<table class="list">
			<tr>
				<th>Name</th>
				<th>Value</th>
			</tr>
			<tr>
				<td><code>false</code></td>
				<td><code>0</code></td>
			</tr>
			<tr>
				<td><code>true</code></td>
				<td><code>1</code></td>
			</tr>
			<tr>
				<td><code>pi</code></td>
				<td>&pi; or <code>3.14159...</code></td>
			</tr>
		</table>
	</section>
	
	
	<br/>
	<br/>
	<section id="expression-operators">
		<SET cii='cii + 1'/>
		<h3><a href="#expression-operators">{ci}.{cii}. Operators</a></h3>
		<p>
			Expression operators consist of standard unary and binary operators:
			<ul>
				<li><b>Unary operatos:</b>
					<code>-</code> (arithmetic negation),
					<code>!</code> (boolean negation)
				</li>
				<li><b>Arithmetic binary operators:</b>
					<code>+</code>,
					<code>-</code>,
					<code>*</code>,
					<code>/</code>,
					<code>%</code>
				</li>
				<li><b>Logical operators:</b>
					<code>&&</code> (and),
					<code>||</code> (or)
				</li>
				<li><b>Comparison binary operators:</b>
					<code>==</code>,
					<code>!=</code>,
					<code>&lt;</code>,
					<code>&lt;=</code>,
					<code>&gt;</code>,
					<code>&gt;=</code>
				</li>
			</ul>
		</p>
		<br/>
		<p>
			For some operations with operands of different types, some of the operands might get coerced/casted into other types.
			For example, adding a number to a string results in the number being stringified and appended to the string operand.
			Another case is coercing a string into a boolean where it evaluates to <code>true</code> when it's not empty.
		</p>
		
		<br/>
		<style>
			#expression-operators table td:nth-of-type(2) {
				max-width: 500px;
				text-align: justify;
				padding-left: 10px;
				padding-right: 10px;
			}
			#expression-operators table tr > *:nth-of-type(1),
			#expression-operators table tr > *:nth-of-type(3) {
				white-space: nowrap;
			}
			#expression-operators table td:nth-of-type(1) {
				font-family: monospace;
				text-align: justify;
			}
		</style>
		<p>
			Here is a list of notable cases of operations between different types:
			<table class="list">
				<tr>
					<th>Operation</th>
					<th>Description</th>
					<th>Example</th>
				</tr>
				<tr>
					<td>
						<span>string <code>+</code> any</span>
					</td>
					<td>
						The second operand is converted into a string and then appended to the main string operand.
					</td>
					<td>
						<code>&quot;x is &quot; + 3</code> &rarr; <code>&quot;x is 3&quot;</code>
					</td>
				</tr>
				<tr>
					<td>
						string <code>*</code> number
					</td>
					<td>
						Produces a string that is appended to itself <var>n</var> times, where the number is casted into an <i>int</i>.
					</td>
					<td>
						<code>&quot;a&quot; * 3</code> &rarr; <code>&quot;aaa&quot;</code>
					</td>
				</tr>
				<tr>
					<td>
						string <code>-</code> number
					</td>
					<td>
						Shortens the string by <var>n</var> characters.
					</td>
					<td>
						<code>&quot;abc&quot; - 2</code> &rarr; <code>&quot;a&quot;</code>
					</td>
				</tr>
				<tr>
					<td>
						<span><code>!</code>string</span>,<br/>
						<span>string <code>||</code> any</span>,<br/>
						<span>string <code>&&</code> any</span>
					</td>
					<td>
						The string is converted into a <i>bool</i>, equivalent to <code>len(string) != 0</code>
					</td>
					<td>
						<code>&quot;a&quot; || &quot;&quot;</code> &rarr; <code>true || false</code> &rarr; <code>1</code>
					</td>
				</tr>
				<tr>
					<td>
						<span><code>!</code>number</span>,<br/>
						<span>number <code>||</code> any</span>,<br/>
						<span>number <code>&&</code> any</span>
					</td>
					<td>
						The number is converted into a <i>bool</i>, equivalent to <code>number != 0</code>
					</td>
					<td>
						<code>!10</code> &rarr; <code>!true</code> &rarr; <code>0</code>
					</td>
				</tr>
				<tr>
					<td>
						<span>float <code>%</code> number</span>
					</td>
					<td>
						Produces a remainder the same way it is done with an <i>int</i>.
					</td>
					<td>
						<code>3.6 % 1.25</code> &rarr; <code>1.1</code>
					</td>
				</tr>
			</table>
		</p>
		
		
		<br/>
		<p>
			For invalid operations between certain types, either <code>0</code> or a copy of the first operand is produced.
		</p>
		
	</section>
	
	
	<br/>
	<br/>
	<section id="expression-variables">
		<SET cii='cii + 1'/>
		<h3><a href="#expression-variables">{ci}.{cii}. Variables</a></h3>
		<p>
			Variable identifiers comprise of alpha-numerical and underscore characters, where the first character cannot be a digit.
			The equivalent regex would be: <code>[a-zA-Z_][a-zA-Z0-9_]+</code>.
			They are defined/assigned with the <a CALL="link-em-SET">&lt;SET/&gt;</a> macro and can be referenced globally from all expressions.
			The types of their values are dynamic and correspond to their most recently assigned value type.
		</p>
		
		<br/>
		<p>
			At program start, some variables get predefined values, as explained in the chapter on <a href="#expression-constants">constants</a>.
			The user can also provide more predefined variables through command-line options in the form of <code>name=value</code>, as explained in the <a href="#cli">command-line interface</a> chapter.
		</p>
		
		<br/>
		<div class="example">
			<h4><b>Example:</b> Defining and using variables.</h4>
			<table>
				<tr>
					<th>input</th>
					<th>output</th>
				</tr>
				<tr>
					<td class="code">
						&lt;<a CALL="link-em-SET">SET</a> <span title="Set variable s to string &quot;header&quot;">s="header"</span>/&gt;<br/>
						&lt;p <span title="Set value of the attribute to the result of the expression, which is just the content of the variable s">class='s'</span>&gt;My title&lt;/p&gt;<br/>
						<br/>
						&lt;<a CALL="link-em-SET">SET</a> <span title="Set variable x to 2">x='2'</span> <span title="Set variable y to 3">y='3'</span>/&gt;<br/>
						&lt;p&gt;My text number <span title="Replace this expression with its result (8)">\{x * (y + 1)}</span>&lt;/p&gt;
					</td>
					<td class="code">
						&lt;p class="header"&gt;My title&lt;/p&gt;<br/>
						&lt;p&gt;My text number 8&lt;/p&gt;
					</td>
				</tr>
			</table>
		</div>
	</section>
	
	
	<br/>
	<br/>
	<section id="expression-functions">
		<SET cii='cii + 1'/>
		<h3><a href="#expression-functions">{ci}.{cii}. Functions</a></h3>
		<p>
			Functions are predefined and can be invoked using their name, suffixed with brackets <code>()</code> containing their arguments.
			The maximum number of arguments for variadic functions is 8.
		</p>
		
		<br/>
		<style>
			#expression-functions table td:nth-child(3) {
				min-width: 12em;
				padding: 5px 1em;
				text-align: left;
			}
			#expression-functions table tr.br {
				border-top: 2px solid black;
			}
		</style>
		<p>List of functions:</p>
		<table class="list">
			<tr>
				<th>Name</th>
				<th>Return type</th>
				<th>Description</th>
				<th>Example</th>
			</tr>
			<tr id="function-int" class="br">
				<td><code>int(x)</code></td>
				<td>int</td>
				<td>
					Converts <code>x</code> into an <i>integer</i>.
					If <code>x</code> is a <i>string</i> and cannot be parsed as an <i>integer</i>, returns <code>0</code>.
				</td>
				<td>
					<code>int('7.234')</code> &rarr; <code>7</code>
				</td>
			</tr>
			<tr id="function-float">
				<td><code>float(x)</code></td>
				<td>float</td>
				<td>
					Converts <code>x</code> into a <i>float</i>.
					If <code>x</code> is a <i>string</i> and cannot be parsed as a <i>float</i>, returns <code>0.0</code>.
				</td>
				<td>
					<code>float('122.5') + 1</code> &rarr; <code>123.5</code>
				</td>
			</tr>
			<tr id="function-str">
				<td><code>str(x)</code></td>
				<td>string</td>
				<td>Converts <code>x</code> into a <i>string</i>.</td>
				<td>
					<code>str(12) + ' apples'</code> &rarr; <code>12 apples</code>
				</td>
			</tr>
			<tr id="function-len" class="br">
				<td><code>len(x)</code></td>
				<td>int</td>
				<td>
					If <code>x</code> is a <i>string</i>, returns length of the <i>string</i>.
					If <code>x</code> is a <i>number</i>, returns the absolute value of the <i>number</i>.
				</td>
				<td>
					<code>len('hello')</code> &rarr; <code>5</code>
				</td>
			</tr>
			<tr id="function-abs">
				<td><code>abs(x)</code></td>
				<td>int</td>
				<td>
					If <code>x</code> is a <i>string</i>, returns length of the <i>string</i>.
					If <code>x</code> is a <i>number</i>, returns the absolute value of the <i>number</i>.
				</td>
				<td>
					<code>abs(-4.5)</code> &rarr; <code>4.5</code>
				</td>
			</tr>
			<tr id="function-min">
				<td><code>min(x, y, ...)</code></td>
				<td>int,<br/>float,<br/>string</td>
				<td>Returns smallest <i>number</i> or shortest <i>string</i>.</td>
				<td>
					<code>min(1, 2.5, 'three')</code> &rarr; <code>1</code>
				</td>
			</tr>
			<tr id="function-max">
				<td><code>max(x, y, ...)</code></td>
				<td>int,<br/>float,<br/>string</td>
				<td>Returns largest <i>number</i> or longest <i>string</i>.</td>
				<td>
					<code>max(1, 2.5, 'three')</code> &rarr; <code>three</code>
				</td>
			</tr>
			<tr id="function-lower" class="br">
				<td><code>lower(s)</code></td>
				<td>string</td>
				<td>Converts <i>string</i> <code>s</code> to lower case.</td>
				<td>
					<code>lower('World!')</code> &rarr; <code>world</code>
				</td>
			</tr>
			<tr id="function-upper">
				<td><code>upper(s)</code></td>
				<td>string</td>
				<td>Converts <i>string</i> <code>s</code> to upper case.</td>
				<td>
					<code>upper(&quot;World!&quot;)</code> &rarr; <code>WORLD</code>
				</td>
			</tr>
			<tr id="function-substr">
				<td><code>substr(s, i, [len])</code></td>
				<td>string</td>
				<!-- <td>
					Returns substring of <i>string</i> <code>s</code>
					beginning at character <code>beg</code> and ending at (excluding) character <code>end</code> (default <code>-1</code>).<br/>
					If <code>beg</code> or <code>end</code> are negative, they go from the end of the string backwards.
					Beginning and end points of the substring are sorted and clamped between <code>0</code> and <code>len(s)</code>.
				</td> -->
				<td>
					Returns substring of <i>string</i> <code>s</code>
					beginning at character <code>i</code> and ending at character <code>i+len</code>, where default value of <code>len</code> is the length of the string <code>s</code>.
					<br/>
					If <code>i</code> is negative, it equals to <code>len(s)-abs(i)</code> (that is from the end backwards).
					Length <code>len</code> can also be negative, meaning it selects characters from <code>i</code> backwards.
					<br/>
					Beginning and end points of the substring are clamped between <code>0</code> and <code>len(s)</code>.
				</td>
				<td>
					<code>substr(&quot;green&quot;, 1)</code> &rarr; <code>&quot;reen&quot;</code><br/>
					<code>substr(&quot;green&quot;, 1, 3)</code> &rarr; <code>&quot;ree&quot;</code><br/>
					<code>substr(&quot;green&quot;, -4, 3)</code> &rarr; <code>&quot;ree&quot;</code><br/>
					<code>substr(&quot;green&quot;, -1, -3)</code> &rarr; <code>&quot;ree&quot;</code>
				</td>
			</tr>
			<tr id="function-match">
				<td><code>match(s, regex)</code></td>
				<td>bool</td>
				<td>
					Returns <code>true</code> if <i>string</i> <code>s</code> matches the <a href="https://en.wikipedia.org/wiki/Regular_expression" title="Wikipedia - Regular expression" target="_blank" class="TD-0">regular expression</a> <code>regex</code>.
				</td>
				<td>
					<code>match('1:5', '\d:\d')</code> &rarr; <code>1</code>
				</td>
			</tr>
			<tr id="function-replace">
				<td><code>replace(s, regex, rep)</code></td>
				<td>string</td>
				<td>
					Replaces all occurances of substrings matched by
					<a href="https://en.wikipedia.org/wiki/Regular_expression" title="Wikipedia - Regular expression" target="_blank" class="TD-0">regular expression</a> <code>regex</code>
					with parameterised replacement <i>string</i> <code>rep</code>.<br/>
					To use capture groups in <code>rep</code>, use <code>$</code> and the number of the capture group.
					The whole match is represented by capture group <code>$0</code>.
				</td>
				<td>
					<code>replace('12 apples', '(\d+)\s+(\w+)', '$1 green $2')</code> &rarr; <code>12 green apples</code>
				</td>
			</tr>
			<tr id="function-if" class="br">
				<td><code>if(cond, pass, else)</code></td>
				<td>int,<br/>float,<br/>string</td>
				<td>
					If <code>cond</code> evaluates to logical <code>true</code>, evaluates and returns <code>pass</code>,
					otherwise evaluates and returns <code>else</code>.
				</td>
				<td>
					<code>if(3 > 2, &quot;yes&quot;, &quot;no&quot;)</code> &rarr; <code>&quot;yes&quot;</code>
				</td>
			</tr>
			<tr id="function-defined">
				<td><code>defined(var)</code></td>
				<td>bool</td>
				<td>
					Returns <code>true</code> if variable <code>var</code> is defined.<br/>
					<code>var</code> is not a string but an identifier that reflects the name of a variable.
				</td>
				<td>
					<code>if(defined(x),x,100)</code> &rarr; <code>100</code>
				</td>
			</tr>
		</table>
	</section>
	
	
</section>